# WPA2-PSK Handshake Capture & Cracking Tutorial

## 1. Overview

- **Objective**: This tutorial provides a step-by-step guide to understanding and executing an offline cracking attack against a captured WPA2-PSK 4-way handshake.
- **What You'll Learn**:
    - The theoretical vulnerability in the WPA2-PSK handshake process.
    - How to set up a basic lab environment in Kali Linux for wireless security testing.
    - How to analyze a sample handshake capture file using Wireshark.
    - Two distinct workflows for cracking the captured handshake to recover the Pre-Shared Key (PSK).
    - The ethical considerations and legal boundaries of wireless network auditing.
- **Scope**: This guide focuses exclusively on analyzing a pre-existing capture file. Live network interaction, such as packet sniffing or de-authentication attacks, is outside the scope of this document and will be covered in a future tutorial.

### WPA2 Background
- **WPA2-Personal (PSK)**: The most common security protocol for home and small business Wi-Fi networks. It uses a single password (Pre-Shared Key) for all users to access the network.
- **The 4-Way Handshake**: A critical process that occurs when a device connects to a WPA2-PSK network. Its purpose is to confirm that both the client and the access point know the correct PSK without ever transmitting the key itself. It generates a unique encryption key (PTK) for the session.

### The 4-Way Handshake Vulnerability
- **Passive Eavesdropping**: An attacker within range of the Wi-Fi network can passively capture all wireless traffic, including the handshake messages.
- **Offline Attack**: If all four EAPOL (Extensible Authentication Protocol over LAN) messages of the handshake are captured, the attacker can take this data offline.
- **Brute-Force/Dictionary Attack**: Using the captured handshake, the attacker can repeatedly guess the PSK against the captured data until a match is found. This is done on the attacker's own machine and is undetectable by the target network.

## 2. Lab Setup

This tutorial assumes you are using a Kali Linux virtual machine, which comes pre-installed with the necessary tools.

- **Hardware Requirements**:
    - A standard computer capable of running a virtual machine.
    - At least 4GB of RAM and 20GB of free disk space for the VM.
    - **Note**: A special wireless adapter is **not** needed for this part of the tutorial, as we are working with a sample file.
- **Software Requirements**:
    - **Virtualization Software**: VirtualBox (recommended) or VMware Workstation Player.
    - **Operating System**: A current Kali Linux VM image.
- **Tool Installation**:
    - Run the following commands in the Kali terminal to ensure all tools are installed and up-to-date:
    ```bash
    sudo apt update && sudo apt upgrade -y
    sudo apt install -y aircrack-ng wireshark tshark hcxtools hashcat
    ```
- **Tool Breakdown**:
    - `aircrack-ng`: A suite of tools for auditing wireless networks. We will use it for a simple cracking workflow.
    - `wireshark`: A graphical network protocol analyzer used to inspect the captured handshake.
    - `tshark`: The command-line version of Wireshark, useful for scripting and automation.
    - `hcxtools`: A powerful set of tools to convert and manipulate handshake captures for modern cracking tools.
    - `hashcat`: The world's fastest and most advanced password recovery utility, capable of leveraging GPUs for massive speed improvements.

## 3. Using a Sample Capture

For this phase, we will use a pre-existing capture file named `wpa2_handshake.pcap`.

> **[Placeholder: Link to download `wpa2_handshake.pcap` file]**

- **Step 1: Open the Capture in Wireshark**
    - Launch Wireshark from the Kali menu or by typing `wireshark` in the terminal.
    - Go to `File` > `Open` and select the `wpa2_handshake.pcap` file.
- **Step 2: Filter for Handshake Packets**
    - In the Wireshark display filter bar at the top, type `eapol` and press Enter.
    - This filter isolates the 4-way handshake packets from all other captured traffic.
- **Step 3: Identify the Complete Handshake**
    - Look for a sequence of four EAPOL packets.
    - Wireshark's "Info" column is very helpful here, as it will often label the packets as "Message 1 of 4", "Message 2 of 4", etc.
    - Verify that these four messages are exchanged between the same two devices (the Access Point and a single Client).

> **[Screenshot Placeholder: Wireshark window showing the filtered 4-way handshake with annotations pointing to the client, AP, and the four EAPOL messages.]**

## 4. Cracking Workflow

With a valid handshake identified in our capture file, we can proceed to the cracking phase.

### Method A: `aircrack-ng` (CPU-Based, Simple)
This method is straightforward and great for beginners. It uses the CPU and is slower but works directly with `.cap` files.

- **Step 1: Identify the Target Network**
    - Note the BSSID (MAC address) of the Access Point from the Wireshark capture.
- **Step 2: Prepare a Wordlist**
    - A wordlist is a text file containing one potential password per line. Kali comes with some default lists, like `rockyou.txt`.
- **Step 3: Run the Cracking Command**
    ```bash
    aircrack-ng -w /path/to/your/wordlist.txt -b <BSSID> wpa2_handshake.pcap
    ```
    - `-w`: Specifies the path to your wordlist file.
    - `-b`: Specifies the BSSID of the target Access Point.
    - `aircrack-ng` will confirm a handshake is present and begin testing keys.

### Method B: `hcxtools` and `hashcat` (GPU-Based, Advanced)
This is the professional method, offering significantly higher cracking speeds by using a GPU.

- **Step 1: Convert the Capture File**
    - Use `hcxpcapngtool` from the `hcxtools` suite to extract the handshake and convert it into a hash format that `hashcat` understands.
    ```bash
    hcxpcapngtool -o hash.22000 wpa2_handshake.pcap
    ```
    - This command creates a new file, `hash.22000`, containing only the essential data for cracking.
- **Step 2: Run `hashcat`**
    - Execute the `hashcat` command to begin the cracking process.
    ```bash
    hashcat -m 22000 hash.22000 /path/to/your/wordlist.txt
    ```
    - `-m 22000`: This is crucial. It tells `hashcat` the specific hash type we are targeting (WPA2-PSK).
    - The first argument is the converted hash file.
    - The second argument is the wordlist.
    - `hashcat` will start, utilizing the GPU if available, and show progress as it works through the wordlist.

## 5. Ethics and Scope

- **Legal Warning**: Unauthorized access to computer networks is a criminal offense in most jurisdictions. This tutorial is for educational purposes only.
- **Rule of Engagement**:
    - **Only** perform these techniques on networks you personally own.
    - **Only** perform these techniques on networks where you have received explicit, written permission from the owner to conduct security testing.
- **Our Scope**: For this guide, we are strictly working with a pre-recorded capture file to learn the technical process. We are **not** performing any live packet capture or interacting with any networks we do not own.

## 6. WPA3 Notes

WPA3 is the modern security standard that directly addresses the handshake capture vulnerability of WPA2.

- **SAE (Simultaneous Authentication of Equals)**:
    - WPA3 replaces the 4-way handshake with a new method called SAE, also known as the "Dragonfly" handshake.
    - SAE is an interactive key exchange that is resistant to offline dictionary attacks. Even if an attacker captures the entire SAE handshake, they cannot take it offline to guess passwords.
- **WPA2/WPA3 Transition Mode**:
    - Many modern routers operate in a "transition mode" to support both older WPA2 devices and newer WPA3 devices.
    - **Warning**: This mode is still vulnerable. If a WPA2 device connects to a network in transition mode, it will use the classic 4-way handshake, which can be captured and cracked using the methods described in this tutorial.
- **Further Reading**: For a deep dive into the cryptographic details and early implementation flaws, research the **Dragonblood** attack.

## 7. Checklist for Live Capture (Future Tutorial)

This checklist outlines the steps for a future tutorial involving live network capture. **Do not attempt these without a compatible adapter and a fully authorized test network.**

- [ ] Acquire a compatible wireless network adapter (e.g., Alfa AWUS036NHA).
- [ ] Verify the adapter is recognized by Kali Linux (`iwconfig`, `lsusb`).
- [ ] Practice putting the adapter into monitor mode (`sudo airmon-ng start wlan0`).
- [ ] Practice using `airodump-ng` to scan for local networks and identify targets.
- [ ] Develop a clear plan for capturing a handshake from an **authorized** test network.
- [ ] Review and document understanding of local laws and regulations regarding wireless network auditing.
